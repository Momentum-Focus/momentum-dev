generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Role {
  id        Int        @id @default(autoincrement())
  name      String     @unique
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  deletedAt DateTime?
  user      UserRole[]
}

model User {
  id                  Int               @id @default(autoincrement())
  name                String
  email               String            @unique
  phone               String?           @unique
  password            String?
  emailVerified       Boolean           @default(false)
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  deletedAt           DateTime?
  isSpotifyConnected  Boolean           @default(false)
  spotifyAccessToken  String?
  spotifyRefreshToken String?
  authMethod          AuthMethod        @default(EMAIL)
  googleAccessToken   String?
  googleId            String?           @unique
  googleRefreshToken  String?
  isGoogleConnected   Boolean           @default(false)
  cpf                 String?           @unique
  spotifyProduct      String?
  comments            Comment[]
  dailyLogs           DailyLog[]
  logs                LogActivity[]
  media               Media[]
  notifications       Notification[]
  projects            Project[]
  reports             Report[]
  savedPlaylists      SavedPlaylist[]
  settings            SettingsFocus?
  studySessions       StudySession[]
  subscriptions       Subscription?
  tags                Tag[]
  tasks               Task[]
  achievements        UserAchievement[]
  roles               UserRole[]
}

model Media {
  id        Int       @id @default(autoincrement())
  type      MediaType
  url       String
  isActive  Boolean   @default(false)
  userId    Int
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  user      User      @relation(fields: [userId], references: [id])
}

model SettingsFocus {
  id                        Int       @id @default(autoincrement())
  userId                    Int       @unique
  focusDurationMinutes      Int       @default(25)
  shortBreakDurationMinutes Int       @default(5)
  longBreakDurationMinutes  Int       @default(15)
  cyclesBeforeLongBreak     Int       @default(4)
  themeColor                String?   @default("#3B82F6")
  createdAt                 DateTime  @default(now())
  updatedAt                 DateTime  @updatedAt
  deletedAt                 DateTime?
  user                      User      @relation(fields: [userId], references: [id])
}

model UserRole {
  id        Int       @id @default(autoincrement())
  userId    Int
  roleId    Int
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  role      Role      @relation(fields: [roleId], references: [id])
  user      User      @relation(fields: [userId], references: [id])

  @@unique([userId, roleId])
}

model Notification {
  id        Int                @id @default(autoincrement())
  userId    Int
  title     String
  message   String
  status    NotificationStatus @default(UNREAD)
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt
  deletedAt DateTime?
  user      User               @relation(fields: [userId], references: [id])
}

model Task {
  id                       Int            @id @default(autoincrement())
  userId                   Int
  title                    String
  description              String?
  priority                 TaskPriority   @default(MEDIUM)
  isCompleted              Boolean        @default(false)
  completedAt              DateTime?
  estimatedDurationMinutes Int?
  estimatedSessions        Int?
  actualDurationMinutes    Int            @default(0)
  createdAt                DateTime       @default(now())
  updatedAt                DateTime       @updatedAt
  deletedAt                DateTime?
  projectId                Int?
  comments                 Comment[]
  studySessions            StudySession[]
  tags                     TagTask[]
  project                  Project?       @relation(fields: [projectId], references: [id])
  user                     User           @relation(fields: [userId], references: [id])
}

model Project {
  id          Int           @id @default(autoincrement())
  name        String
  description String?
  status      ProjectStatus @default(NOT_STARTED)
  dueDate     DateTime?
  completedAt DateTime?
  color       String?
  userId      Int
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  deletedAt   DateTime?
  comments    Comment[]
  user        User          @relation(fields: [userId], references: [id])
  tasks       Task[]
}

model StudySession {
  id              Int         @id @default(autoincrement())
  userId          Int
  taskId          Int?
  startedAt       DateTime
  endedAt         DateTime?
  durationMinutes Int?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  deletedAt       DateTime?
  typeSession     SessionType
  task            Task?       @relation(fields: [taskId], references: [id])
  user            User        @relation(fields: [userId], references: [id])
}

model DailyLog {
  id                Int       @id @default(autoincrement())
  userId            Int
  date              DateTime  @db.Date
  totalFocusMinutes Int       @default(0)
  totalPauseMinutes Int       @default(0)
  tasksCompleted    Int       @default(0)
  completedSessions Int       @default(0)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  deletedAt         DateTime?
  user              User      @relation(fields: [userId], references: [id])

  @@unique([userId, date])
}

model Plan {
  id            Int            @id @default(autoincrement())
  name          String         @unique
  description   String?
  price         Decimal?
  billingCycle  BillingCycle?
  isActive      Boolean        @default(true)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  deletedAt     DateTime?
  features      PlanFeature[]
  subscriptions Subscription[]
}

model Feature {
  id          Int           @id @default(autoincrement())
  code        String        @unique
  name        String
  description String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  deletedAt   DateTime?
  plans       PlanFeature[]
}

model PlanFeature {
  id        Int      @id @default(autoincrement())
  planId    Int
  featureId Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  feature   Feature  @relation(fields: [featureId], references: [id])
  plan      Plan     @relation(fields: [planId], references: [id])

  @@unique([planId, featureId])
}

model Subscription {
  id           Int                @id @default(autoincrement())
  status       SubscriptionStatus
  startDate    DateTime
  endDate      DateTime?
  trialEndDate DateTime?
  userId       Int                @unique
  planId       Int
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  deletedAt    DateTime?
  plan         Plan               @relation(fields: [planId], references: [id])
  user         User               @relation(fields: [userId], references: [id])
}

model LogActivity {
  id        Int           @id @default(autoincrement())
  userId    Int?
  action    LogActionType
  details   String?
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  deletedAt DateTime?
  user      User?         @relation(fields: [userId], references: [id])
}

model Report {
  id          Int          @id @default(autoincrement())
  userId      Int
  title       String
  description String
  type        ReportType
  status      ReportStatus @default(OPEN)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  deletedAt   DateTime?
  user        User         @relation(fields: [userId], references: [id])
}

model Tag {
  id        Int       @id @default(autoincrement())
  name      String
  color     String?
  userId    Int
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  user      User      @relation(fields: [userId], references: [id])
  tasks     TagTask[]

  @@unique([userId, name])
}

model TagTask {
  id        Int      @id @default(autoincrement())
  tagId     Int
  taskId    Int
  createdAt DateTime @default(now())
  tag       Tag      @relation(fields: [tagId], references: [id], onDelete: Cascade)
  task      Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@unique([tagId, taskId])
}

model Comment {
  id        Int       @id @default(autoincrement())
  content   String
  userId    Int
  taskId    Int?
  projectId Int?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  project   Project?  @relation(fields: [projectId], references: [id])
  task      Task?     @relation(fields: [taskId], references: [id])
  user      User      @relation(fields: [userId], references: [id])
}

model Achievement {
  id          Int               @id @default(autoincrement())
  code        AchievementCode   @unique
  name        String
  description String
  iconUrl     String?
  users       UserAchievement[]
}

model UserAchievement {
  id            Int         @id @default(autoincrement())
  earnedAt      DateTime    @default(now())
  userId        Int
  achievementId Int
  achievement   Achievement @relation(fields: [achievementId], references: [id])
  user          User        @relation(fields: [userId], references: [id])

  @@unique([userId, achievementId])
}

model SavedPlaylist {
  id           Int           @id @default(autoincrement())
  userId       Int
  externalId   String
  provider     MediaProvider
  title        String?
  thumbnailUrl String?
  isHidden     Boolean       @default(false)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  deletedAt    DateTime?
  isFocus      Boolean       @default(false)
  user         User          @relation(fields: [userId], references: [id])

  @@unique([userId, externalId, provider])
  @@index([userId, provider, isHidden])
  @@index([userId, isFocus])
}

enum AuthMethod {
  EMAIL
  GOOGLE
}

enum MediaType {
  IMAGE
  VIDEO
}

enum NotificationStatus {
  UNREAD
  READ
}

enum TaskPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum ProjectStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
}

enum SessionType {
  FOCUS
  SHORT_BREAK
  LONG_BREAK
}

enum BillingCycle {
  MONTHLY
  YEARLY
}

enum SubscriptionStatus {
  ACTIVE
  CANCELED
  PAST_DUE
  INCOMPLETE
  TRIALING
}

enum LogActionType {
  USER_REGISTER
  USER_LOGIN
  USER_PASSWORD_UPDATE
  USER_PROFILE_UPDATE
  TASK_CREATE
  TASK_UPDATE
  TASK_DELETE
  TASK_COMPLETE
  SETTINGS_UPDATE
  USER_LOGIN_SUCCESS
  USER_LOGIN_FAILED
  USER_DELETE_ACCOUNT
  PROJECT_CREATE
  PROJECT_UPDATE
  PROJECT_DELETE
  PROJECT_COMPLETE
  TAG_CREATE
  TAG_UPDATE
  TAG_DELETE
  COMMENT_CREATE
  COMMENT_DELETE
  ACHIEVEMENT_EARNED
  MEDIA_CONNECT_SPOTIFY
  MEDIA_CONNECT_GOOGLE
  GENERIC_ERROR
  MEDIA_DISCONNECT_SPOTIFY
  MEDIA_DISCONNECT_GOOGLE
}

enum ReportType {
  BUG_REPORT
  FEATURE_REQUEST
  QUESTION
  GENERAL_FEEDBACK
  PRIORITY
}

enum ReportStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
}

enum MediaProvider {
  SPOTIFY
  YOUTUBE
}

enum CommentType {
  PROJECT
  TASK
}

enum AchievementCode {
  STREAK_3_DAYS
  STREAK_7_DAYS
  STREAK_30_DAYS
  FIRST_TASK_COMPLETED
  TASKS_10_COMPLETED
  TASKS_100_COMPLETED
  FIRST_PROJECT_COMPLETED
  FOCUS_10_HOURS
  FOCUS_100_HOURS
}
